-- 判斷資料庫是否存在，存在的話先刪除
-- 建立 shop資料庫
-- 使用 shop資料庫
DROP DATABASE IF EXISTS shop;
CREATE DATABASE shop;
USE shop;

-- 刪除已存在的 user 表單
-- 建立 user 表單
DROP TABLE IF EXISTS user;
CREATE TABLE user (
    user_id INT AUTO_INCREMENT PRIMARY KEY,
    account VARCHAR(50) UNIQUE NOT NULL,
    password VARCHAR(255) NOT NULL,
    salt VARCHAR(255) NOT NULL DEFAULT '',
    name VARCHAR(50) NOT NULL,
    gender VARCHAR(10),
    birthday DATE,
    email VARCHAR(100) UNIQUE NOT NULL,
    phone VARCHAR(20),
    is_user INT(10) CHECK (is_user IN (1, 2)) DEFAULT 2
    -- is_user 權限 (1：管理者, 2：一般會員)
);

-- 刪除已存在的 product 表單
-- 建立 product 表單
DROP TABLE IF EXISTS product;
CREATE TABLE product (
    product_id INT AUTO_INCREMENT PRIMARY KEY,
    product_name VARCHAR(50) UNIQUE NOT NULL,
    product_type VARCHAR(30),
    description VARCHAR(250),
    product_price INT,
    product_image VARCHAR(50) DEFAULT NULL
);

-- 刪除已存在的 news 表單
-- 建立 news 表單
DROP TABLE IF EXISTS news;
CREATE TABLE news (
    news_id INT AUTO_INCREMENT PRIMARY KEY,
    news_title VARCHAR(50) UNIQUE NOT NULL,
    content VARCHAR(250),
    news_image VARCHAR(50) DEFAULT NULL,
    start_date DATE,
    end_date DATE,
    combo_name VARCHAR(50),
    combo_price INT
);

-- 刪除已存在的 order 表單
-- 建立 orders 表單
CREATE TABLE orders (
    order_id INT AUTO_INCREMENT PRIMARY KEY,
    order_time DATETIME DEFAULT CURRENT_TIMESTAMP
    ALTER TABLE orders ADD COLUMN total_price DECIMAL(10, 2);
    ADD COLUMN user_name VARCHAR(255),
    ADD COLUMN user_address VARCHAR(255),
    ADD COLUMN user_phone VARCHAR(20);
);


-- 刪除已存在的 order_items 表單
-- 建立 order_items 表單
CREATE TABLE order_items (
    order_item_id INT AUTO_INCREMENT PRIMARY KEY,
    order_id INT,
    order_name VARCHAR(50) NOT NULL,
    quantity INT,
    price INT,
    FOREIGN KEY (order_id) REFERENCES orders(order_id)
);

INSERT INTO user (account, password, salt, name, gender, birthday, email, phone, is_user) VALUES
('Tomorin','94f0b3709257680516951d21a0dcb47746eb3a7cf06d95c9e4c75fcb316b946d', '7d27edc27ab19bb04a553c726af68b99','Tomorin','女生', '2006-11-22', 'Tomorin@gmail.com', '0911451422',1),
('okita', '09d57a217c0cfcf4ef50f65ab51e4dbc7038eb65fed450134d1a42ce0cf9117d', '3e86e9c514081bdd76bd00f0bc283f92', 'okita', '男生', '2024-12-13', 'okita630@gmail.com', '0979173183', 2),
('Toki', 'ed1819d786a3ff0510be48a54011766d8a13fd5552f29d6976cfa708401e67cd', '2cd8220189794d12c2badbbb112e7c67', 'Toki' , '男生', '2001-11-16', 'toki114514@gmail.com', '0979114514', 2),